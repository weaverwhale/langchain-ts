<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Status</title>
    <link rel="icon" href="/favicon.svg" />
    <style>
      pre {
        display: inline;
      }
      #app {
        margin: 0 auto;
        width: 80%;
        max-width: 500px;
      }
    </style>
  </head>

  <body>
    <div id="app">
      <h1>üê≥ Status</h1>
      <p>Provides the status of various Triple Whale services.</p>
      <div id="answer">
        <h2>Fetching Services..</h2>
        <p>Please be patient; sometimes he takes 5-10 seconds to reply.</p>
      </div>
    </div>
  </body>

  <script>
    const app = document.getElementById('app')
    fetch(`/get-status${window.location.search}`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
    })
      .then((res) => res.json())
      .then((data) => {
        try {
          const parsedData = JSON.parse(JSON.stringify(data))
          console.log(parsedData)
          document.getElementById('answer').innerHTML = `<h2>Triple Whale Services</h2>${
            parsedData.answer.output
          }${
            parsedData.isCached
              ? `<p><i>Last updated ${parseInt(
                  Math.abs((new Date() - new Date(parseInt(parsedData.time))) / 60000),
                )} minutes ago</i></p>`
              : ''
          }`
        } catch {}
      })
  </script>
</html>
